Array.prototype.del=function(t){t.sort();for(var r=this.concat([]),a=t.length-1;a>=0;a--)r=r.slice(0,t[a]).concat(r.slice(t[a]+1));return r};try{HTMLImageElement.prototype.loadOnce=function(t){var r=0;this.onload=function(){r||t.call(this,null),r++}}}catch(t){window={}}(function(t){function r(){this.readyState&&(this.readyState=0,this.dorsyWorker.startWorker())}var a={lib:[],init:function(){this.require("config")},module:function(t,r){function a(t){n++;var o=e[n];return n==e.length-1?void(t[o]=r.call(null,i)):void a(t[o]?t[o]:t[o]={})}var e=[t];/\./g.test(t)&&(e=t.split("."));var n=-1,i=this;a(this.lib)},require:function(t){var r=this,a=document.createElement("script");document.body.appendChild(a),a.src="./js/module/"+t+".js",a.onload=a.onerror=function(t){r.handlerror(t)}},handlerror:function(t){},destroySelf:function(r){delete window[t];var a=new Error(r);throw a},reflect:function(t,r,a){var e=this.lib.config.getModuleName(t),n=e.spaceName,i=e.actName;switch(n){case"Filter":case"Alteration":return this.lib[n][i].process(r,a);case"ComEffect":return this.lib[i].process(r,a);default:this.destroySelf("AI_ERROR: ")}},reflectEasy:function(t){var r=this.lib.config.getEasyFun(t).actName;return this.lib.easy.getFun(r)},add:function(t,r,a,e,n,i,o,s){return this.lib.addLayer.add(t,r,a,e,n,i,o,s)},worker:function(t,r){},applyMatrix:function(t,r){},tools:function(t,r){var a=Array.prototype.shift.call(r);if(this.lib.Tools[a])return this.lib.Tools[a].process(t,r);throw new Error("AI_ERROR: \u4e0d\u5b58\u5728\u7684\u5de5\u5177\u65b9\u6cd5_"+a)}};window[t]=function(r,e,n){var i=this;if(!(this instanceof window[t]))return new window[t](r,e,n);this.startTime=+new Date;var o=document.createElement("canvas"),s=o.getContext("2d");if(isNaN(r)){o.width=parseInt(r.width),o.height=parseInt(r.height);var h=getComputedStyle(r),c=parseInt(h.getPropertyValue("width")),u=parseInt(h.getPropertyValue("height"));isNaN(c)?s.drawImage(r,0,0):s.drawImage(r,0,0,c,u)}else o.width=r,o.height=e,n=n||"#fff",s.fillStyle=n,s.fillRect(0,0,r,e);this.canvas=o,this.context=s,this.imgData=s.getImageData(0,0,o.width,o.height),this.name=t+"_"+Math.random(),this.canvas.id=this.name,this.layers=[];var f=document.createElement("canvas");if(f.width=o.width,f.height=o.height,this.ctxCanvas=f,this.ctxContext=o.getContext("2d"),this.useWorker=a.useWorker,this.readyState=1,this.useWorker&&(this.dorsyWorker=a.lib.dorsyWorker(this)),a.lib.Tools)for(var d in a.lib.Tools)this.Tools[d]=function(t){return i.Tools(d,t)}},window[t].module=function(t,r){a.module(t,r)},window[t].dorsyMath=function(){return a.lib.dorsyMath},window[t].setName=function(t){a.name=t||"alloyimage.js"},window[t].getConfig=function(){return a.lib.config.getConfig()},window[t].useWorker=function(t){if(!window.Worker)return this.useWorker=0,void console.log("AI_WARNING: \u6d4f\u89c8\u5668\u4e0d\u652f\u6301web worker, \u81ea\u52a8\u5207\u6362\u4e3a\u5355\u7ebf\u7a0b\nAI_WARNING: the brower doesn't support Web Worker");var t=t||"";/[\/\\]$/.test(t)&&(t+=a.name),""==t&&(t="alloyimage.js"),a.useWorker=1,a.path=t;var r=new XMLHttpRequest;r.onreadystatechange=function(){4==r.readyState&&"404"==r.status&&a.destroySelf("AI_ERROR\uff1a\u4f7f\u7528worker\u65f6\uff0cai\u6587\u4ef6\u8def\u5f84\u6307\u5b9a\u9519\u8bef\nAI_ERROR: error occured while using web worker since indicate the wrong path of file ai")},r.open("GET",t,!1),r.send()},onmessage=function(t){var r,e=t.data;"act"==e[0]?r=a.reflect(e[1],e[2],e[3]):"add"==e[0]&&(r=a.add.apply(a,e[1])),r&&postMessage(r)},window[t].prototype={act:function(t,e){var n=[];return n=Array.prototype.slice.call(arguments,1),this.useWorker?(this.dorsyWorker.queue.push(["act",t,n]),r.call(this)):a.reflect(t,this.imgData,n),this},view:function(t,r,a,e,n){var i=this.clone();return i.type=1,this.addLayer(i,"\u6b63\u5e38",0,0),i.act(t,r,a,e,n),this},excute:function(){var t=this.layers,r=t.length;return t[r-1]&&1==t[r-1][0].type&&(this.imgData=t[r-1][0].imgData,t.pop()),this},cancel:function(){var t=this.layers,r=t.length;return t[r-1]&&1==t[r-1][0].type&&t.pop(),this},show:function(r,a,e){if(e);else if(this.useWorker)return this.dorsyWorker.queue.push(["show",r,a]),this;if(0==this.layers.length)this.tempPsLib={imgData:this.imgData};else{var n=new window[t](this.canvas.width,this.canvas.height);n.add(this,"\u6b63\u5e38",0,0,a),this.tempPsLib=n;for(var i=0;i<this.layers.length;i++){var o=this.layers[i],s=o[0].layers,h=o[0];s[s.length-1]&&1==s[s.length-1][0].type&&(h=s[s.length-1][0]),n.add(h,o[1],o[2],o[3],a)}this.context.clearRect(0,0,this.canvas.width,this.canvas.height)}return this.context.putImageData(this.tempPsLib.imgData,0,0),r?document.querySelector(r).appendChild(this.canvas):document.body.appendChild(this.canvas),this},replace:function(t,a){if(a);else if(this.useWorker)return this.dorsyWorker.queue.push(["replace",t]),r.call(this),this;return t&&(t.onload=function(){},t.src=this.save("png",a)),this},add:function(){for(var t,e,n,i,o,s,h,c=[],u=0;u<arguments.length;u++)if(u)switch(typeof arguments[u]){case"string":/\d+%/.test(arguments[u])?n=arguments[u].replace("%",""):/[RGB]+/.test(arguments[u])?h=arguments[u]:e=arguments[u];break;case"number":c.push(arguments[u]);break;case"boolean":s=arguments[u]}return i=c[0]||0,o=c[1]||0,e=e||"\u6b63\u5e38",n=n/100||1,s=s||!1,h=h||"RGB",t=arguments[0],this.useWorker?(this.dorsyWorker.queue.push(["add",t,e,n,i,o,s,h]),r.call(this)):this.imgData=a.add(this.imgData,t.imgData,e,n,i,o,s,h),this},addLayer:function(t,r,a,e){return this.layers.push([t,r,a,e]),this},clone:function(r){var a=new window[t](this.canvas.width,this.canvas.height);return a.context.putImageData(this.imgData,0,0),a.imgData=a.context.getImageData(0,0,this.canvas.width,this.canvas.height),a},swap:function(t,r){var a=this.layers[t];return this.layers[t]=this.layers[r],this.layers[r]=a,this},deleteLayers:function(t){this.layers=this.layers.del(t)},save:function(a,e){a=a||"png",a=a.toLowerCase();var n=0;"jpg"==a&&(a="jpeg");var i="image/"+a;if(e);else if(this.useWorker)return this.dorsyWorker.queue.push(["save"]),r.call(this),this;if(!this.layers.length)return this.context.putImageData(this.imgData,0,0),this.canvas.toDataURL(i);var o=new window[t](this.canvas.width,this.canvas.height);o.add(this,"\u6b63\u5e38",0,0,n),this.tempPsLib=o;for(var s=0;s<this.layers.length;s++){var h=this.layers[s],c=h[0].layers,u=h[0];c[c.length-1]&&1==c[c.length-1][0].type&&(u=c[c.length-1][0]),o.add(u,h[1],h[2],h[3],n)}return this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.putImageData(o.imgData,0,0),this.canvas.toDataURL()},saveFile:function(){var t=this.save();t=t.replace(/^data:image\/(?:(?:jpeg)|(?:png))/,"data:image/octet-stream"),window.location.href=t},drawRect:function(t){var r;(r=document.getElementById("imgRect"))||(r=document.createElement("canvas"),r.id="imgRect",document.body.appendChild(r),r.width=parseInt(this.canvas.width),r.height=parseInt(this.canvas.height));var a=r.getContext("2d");a.clearRect(0,0,r.width,r.height);for(var e=[],n=this.tempPsLib.imgData.data,i=0,o=n.length;i<o;i++)e[n[i]]?e[n[i]]++:e[n[i]]=1;a.beginPath(),a.moveTo(0,r.height);for(var s=0,h=0;h<255;h++)e[h]>s&&(s=e[h]);for(var c=0;c<255;c++){var u=e[c]||0;u=r.height-u/s*.8*r.height,a.lineTo(c/256*r.width,u,1,1)}a.lineTo(r.width+10,r.height),a.fill()},ps:function(t){var r=a.reflectEasy(t),e=this;return e=r.call(e),this.logTime("\u7ec4\u5408\u6548\u679c"+t),e},logTime:function(t){console.log(t+": "+(+new Date-this.startTime)/1e3+"s")},ctx:function(t){var r=this.ctxContext;return r.putImageData(this.imgData,0,0),t.call(r),this.imgData=r.getImageData(0,0,this.canvas.width,this.canvas.height),this},notify:function(t){"readyStateOK"==t&&(this.readyState=1)},complete:function(t){this.useWorker?this.dorsyWorker.queue.push(["complete",t]):t()},transform:function(t){var r=this.ctxContext;r.putImageData(this.imgData,0,0);var a=document.createElement("canvas").getContext("2d");return a.canvas.width=this.canvas.width,a.canvas.height=this.canvas.height,a.transform.apply(a,t),a.drawImage(r.canvas,0,0),this.imgData=a.getImageData(0,0,this.canvas.width,this.canvas.height),this},scale:function(t,r){return r=r||t,this.transform([t,0,0,r,0,0])},rotate:function(t){var r=t/180*Math.PI,a=[Math.cos(r),Math.sin(r),-Math.sin(r),Math.cos(r),0,0];return this.transform(a)},moveTo:function(t,r){return t=t||0,r=r||0,this.transform([1,0,0,1,t,r])},clip:function(t,r,a,e){return this.ctxContext.putImageData(this.imgData,0,0),this.imgData=this.ctxContext.getImageData(t,r,a,e),this.context.canvas.width=a,this.context.canvas.height=e,this},Tools:function(t){return a.tools(this.imgData,arguments)}}})("psLib"),window.AlloyImage=$AI=window.psLib,function(t){window[t].module("addLayer",function(t){var r={add:function(t,r,a,e,n,i,o,s){var h=t.data,c=r.data,n=n||0,i=i||0,e=e||1,s=s||"RGB";/[RGB]+/.test(s)||(s="RGB");for(var u,f,d,l,v,p,g,w,m=s.replace("R","0").replace("G","1").replace("B","2"),y=1,I=t.width,b=(t.height,c.length),M=r.width,x=[m.indexOf("0")>-1,m.indexOf("1")>-1,m.indexOf("2")>-1],k=4*y,C=0,L=h.length;C<L;C+=k)if(f=C/4,d=parseInt(f/I),l=f%I,v=d-i,p=l-n,g=v*M+p,w=4*g,w>=0&&w<b-4&&p<M&&p>=0)for(var R=0;R<3&&0!=c[w+3];R++)switch(h[C+3]=c[w+3],a){case"\u989c\u8272\u51cf\u6de1":x[R]&&(u=h[C+R]+h[C+R]*c[w+R]/(255-c[w+R]),h[C+R]=(1-e)*h[C+R]+e*u);break;case"\u53d8\u6697":x[R]&&(u=h[C+R]<c[w+R]?h[C+R]:c[w+R],h[C+R]=(1-e)*h[C+R]+e*u);break;case"\u53d8\u4eae":x[R]&&(u=h[C+R]>c[w+R]?h[C+R]:c[w+R],h[C+R]=(1-e)*h[C+R]+e*u);break;case"\u6b63\u7247\u53e0\u5e95":x[R]&&(u=parseInt(h[C+R]*c[w+R]/255),h[C+R]=(1-e)*h[C+R]+e*u);break;case"\u6ee4\u8272":x[R]&&(u=parseInt(255-(255-h[C+R])*(255-c[w+R])/255),h[C+R]=(1-e)*h[C+R]+e*u);break;case"\u53e0\u52a0":x[R]&&(u=h[C+R]<=127.5?h[C+R]*c[w+R]/127.5:255-(255-h[C+R])*(255-c[w+R])/127.5,h[C+R]=(1-e)*h[C+R]+e*u);break;case"\u5f3a\u5149":x[R]&&(u=c[w+R]<=127.5?h[C+R]*c[w+R]/127.5:h[C+R]+(255-h[C+R])*(c[w+R]-127.5)/127.5,h[C+R]=(1-e)*h[C+R]+e*u);break;case"\u5dee\u503c":x[R]&&(u=h[C+R]>c[w+R]?h[C+R]-c[w+R]:c[w+R]-h[C+R],h[C+R]=(1-e)*h[C+R]+e*u);break;case"\u6392\u9664":x[R]&&(u=h[C+R]+c[w+R]-h[C+R]*c[w+R]/127.5,h[C+R]=(1-e)*h[C+R]+e*u);break;case"\u70b9\u5149":x[R]&&(u=h[C+R]<2*c[w+R]-255?2*c[w+R]-255:h[C+R]<2*c[w+R]?h[C+R]:2*c[w+R],h[C+R]=(1-e)*h[C+R]+e*u);break;case"\u989c\u8272\u52a0\u6df1":x[R]&&(u=255-255*(255-h[C+R])/c[w+R],h[C+R]=(1-e)*h[C+R]+e*u);break;case"\u7ebf\u6027\u52a0\u6df1":if(x[R]){var D=h[C+R]+c[w+R];u=D>255?D-255:0,h[C+R]=(1-e)*h[C+R]+e*u}break;case"\u7ebf\u6027\u51cf\u6de1":if(x[R]){var D=h[C+R]+c[w+R];u=D>255?255:D,h[C+R]=(1-e)*h[C+R]+e*u}break;case"\u67d4\u5149":x[R]&&(u=c[w+R]<127.5?((2*c[w+R]-255)*(255-h[C+R])/65025+1)*h[C+R]:(2*c[w+R]-255)*(Math.sqrt(h[C+R]/255)-h[C+R]/255)+h[C+R],h[C+R]=(1-e)*h[C+R]+e*u);break;case"\u4eae\u5149":x[R]&&(u=c[w+R]<127.5?255*(1-(255-h[C+R])/(2*c[w+R])):h[C+R]/(2*(1-c[w+R]/255)),h[C+R]=(1-e)*h[C+R]+e*u);break;case"\u7ebf\u6027\u5149":if(x[R]){var D=h[C+R]+2*c[w+R]-255;u=D>255?255:D,h[C+R]=(1-e)*h[C+R]+e*u}break;case"\u5b9e\u8272\u6df7\u5408":x[R]&&(u=c[w+R]<255-h[C+R]?0:255,h[C+R]=(1-e)*h[C+R]+e*u);break;default:x[R]&&(u=c[w+R],h[C+R]=(1-e)*h[C+R]+e*u)}return t}};return r})}("psLib"),function(t){window[t].module("applyMatrix",function(t){var r={process:function(r,a){for(var e=r.data,n=r.width,i=(r.height,new t.lib.dorsyMath.Matrix([-2,-4,-4,-4,-2,-4,0,8,0,-4,-4,8,24,8,-4,-4,0,8,0,-4,-2,-4,-4,-4,-2],25,1)),o=[],s=0,h=e.length;s<h;s+=4){var c=s/4,u=parseInt(c/n),f=c%n;if(0!=u&&0!=f){for(var d=[[],[],[]],l=-2;l<3;l++)for(var v=u+l,p=-2;p<3;p++)for(var g=f+p,w=4*(v*n+g),m=0;m<3;m++){var y=w+m;d[m].push(e[y])}for(var I=new t.lib.dorsyMath.Matrix(d,3,matrixSize),b=I.mutiply(i),m=0;m<3;m++)o[s+m]=b.data[m];o[s+4]=e[s+4]}}for(var s=0,h=e.length;s<h;s++)e[s]=o[s]||e[s];return r}};return r})}("psLib"),function(t){window[t].module("config",function(t){var r={Alteration:{"\u4eae\u5ea6":"brightness","\u8272\u76f8/\u9971\u548c\u5ea6\u8c03\u8282":"setHSI","\u66f2\u7ebf":"curve","gamma\u8c03\u8282":"gamma"},Filter:{"\u7070\u5ea6\u5904\u7406":"toGray","\u53cd\u8272":"toReverse","\u7070\u5ea6\u9608\u503c":"toThresh","\u9ad8\u65af\u6a21\u7cca":"gaussBlur","\u6d6e\u96d5\u6548\u679c":"embossment","\u67e5\u627e\u8fb9\u7f18":"borderline","\u9a6c\u8d5b\u514b":"mosaic","\u6cb9\u753b":"oilPainting","\u8150\u8680":"corrode","\u9510\u5316":"sharp","\u6dfb\u52a0\u6742\u8272":"noise","\u6697\u89d2":"darkCorner","\u55b7\u70b9":"dotted","\u964d\u566a":"denoise","\u68d5\u8910\u8272":"sepia","\u8272\u8c03\u5206\u79bb":"posterize"},ComEffect:{"\u7f8e\u80a4":"softenFace","\u7d20\u63cf":"sketch","\u81ea\u7136\u589e\u5f3a":"softEnhancement","\u7d2b\u8c03":"purpleStyle","\u67d4\u7126":"soften","\u590d\u53e4":"vintage","\u9ed1\u767d":"gray","\u4efflomo":"lomo","\u4eae\u767d\u589e\u5f3a":"strongEnhancement","\u7070\u767d":"strongGray","\u7070\u8272":"lightGray","\u6696\u79cb":"warmAutumn","\u6728\u96d5":"carveStyle","\u7c97\u7cd9":"rough"}},a=function(){var t={};for(var a in r)if("ComEffect"!=a)for(var e in r[a])t[e]=a,t[r[a][e]]=a;return t}(),e={getModuleName:function(e){var n;if(n=a[e]){var i=r[n][e]||e;return{spaceName:n,actName:i}}t.destroySelf("AI_ERROR:\u8c03\u7528AI\u4e0d\u5b58\u5728\u7684\u65b9\u6cd5"+e)},getEasyFun:function(t){return{spaceName:"ComEffect",actName:r.ComEffect[t]||t}},getConfig:function(){return r}};return e})}("psLib"),function(t){window[t].module("dorsyMath",function(t){var r={FFT1:function(t){function a(){i++;for(var t=n/Math.pow(2,i),r=n/t,o=0;o<t;o++)e(o*r,(o+1)*r-1,i);t>1&&a()}function e(a,e,i){for(var s=Math.pow(2,i-1),h=a,c=0;h<=e-s;h++){var u=h+s,f=c*n/Math.pow(2,i),d=f+n/4;t[h]instanceof r.C||(t[h]=new r.C(t[h])),t[u]instanceof r.C||(t[u]=new r.C(t[u]));var l=t[h].plus(t[u].mutiply(o[f])),v=t[h].plus(t[u].mutiply(o[d]));t[h]=l,t[u]=v,c++}}for(var n=t.length,i=0,o=[],s=0;s<n;s++)o[s]=this.exp(-2*Math.PI*s/n);return a(),t},DFT:function(){},Matrix:function(t,r,a){var e=[];if(r){if(isNaN(r))var n=/(\d+)\*/.exec(r)[1],i=/\*(\d+)/.exec(r)[1];else n=r,i=a;if(t[0]&&t[0][0])for(var o=0;o<n;o++){e[o]=[];for(var s=0;s<i;s++)e[o][s]=t[o][s]||0}else for(var o=0;o<n;o++){e[o]=[];for(var s=0;s<i;s++){e[o][s]=t[o*i+s]||0}}this.m=n,this.n=i}else this.m=t.length,this.n=t[0].length;this.data=e},C:function(t,r){this.r=t||0,this.i=r||0},exp:function(t,a){t=t||0,a=a||1;var e=new r.C;return e.r=a*Math.cos(t),e.i=a*Math.sin(t),e},lagrange:function(t,r){function a(r,a){for(var n=1,i=1,o=0;o<e;o++)o!=a&&(n*=t[a]-t[o],i*=r-t[o]);var s=i/n;return s}var e=t.length,n=function(t){for(var n=0,i=0;i<e;i++){var o=a(t,i);n+=r[i]*o}return n};return n},applyMatrix:function(a,e,n){n=n||0;for(var i=a.data,o=a.width,s=(a.height,e.length),h=new r.Matrix(e,s,1),c=[],u=-(Math.sqrt(s)-1)/2,f=0,d=i.length;f<d;f+=4){var l=f/4,v=parseInt(l/o),p=l%o;if(0!=v&&0!=p){for(var g=[[],[],[]],w=u;w<=-u;w++)for(var m=v+w,y=u;y<=-u;y++)for(var I=p+y,b=4*(m*o+I),M=0;M<3;M++){var x=b+M;g[M].push(i[x])}for(var k=new t.lib.dorsyMath.Matrix(g,3,s),C=k.mutiply(h),M=0;M<3;M++)c[f+M]=C.data[M];c[f+4]=i[f+4]}}for(var f=0,d=i.length;f<d;f++)c[f]&&(i[f]=c[f]<n?c[f]:i[f]);return a},RGBToHSI:function(t,r,a){var e=(t-r+t-a)/2/Math.sqrt((t-r)*(t-r)+(t-a)*(r-a))||0;e=Math.acos(e);var n=a>r?2*Math.PI-e:e,i=1-3*Math.min(t,r,a)/(t+r+a),o=(t+r+a)/3;return n>2*Math.PI&&(n=2*Math.PI),n<0&&(n=0),{H:n,S:i,I:o}},HSIToRGB:function(t,r,a){if(t<0?(t%=2*Math.PI,t+=2*Math.PI):t%=2*Math.PI,t<=2*Math.PI/3)var e=a*(1-r),n=a*(1+r*Math.cos(t)/Math.cos(Math.PI/3-t)),i=3*a-(n+e);else if(t<=4*Math.PI/3){t-=2*Math.PI/3;var n=a*(1-r),i=a*(1+r*Math.cos(t)/Math.cos(Math.PI/3-t)),e=3*a-(i+n)}else{t-=4*Math.PI/3;var i=a*(1-r),e=a*(1+r*Math.cos(t)/Math.cos(Math.PI/3-t)),n=3*a-(i+e)}return{R:n,G:i,B:e}},applyInHSI:function(t,r){for(var a=t.data,e=0,n=a.length;e<n;e+=4){var i=this.RGBToHSI(a[e],a[e+1],a[e+2]);r(i),i.S>1&&(i.S=1),i.S<0&&(i.S=0);var o=this.HSIToRGB(i.H,i.S,i.I);a[e]=o.R,a[e+1]=o.G,a[e+2]=o.B}},applyInCoordinate:function(t,r){},distance:function(t,a){a=a||[0,0],t=new r.C(t[0],t[1]),a=new r.C(a[0],a[1]);var e=t.minus(a);return e.distance()},xyToIFun:function(t){return function(r,a,e){return e=e||0,4*(a*t+r)+e}},xyCal:function(t,r,a,e,n){var i=this.xyToIFun(t.width),o=i(r,a,0),s=t.data,h=e(s[o],s[o+1],s[o+2]);s[o]=h[0],s[o+1]=h[1],s[o+2]=h[2],n&&(s[o+3]=n(s[o+3]))}};return r.Matrix.prototype={plus:function(t){if(this.m!=t.m||this.n!=t.n)throw new Error("\u77e9\u9635\u52a0\u6cd5\u884c\u5217\u4e0d\u5339\u914d");for(var a=new r.Matrix([],this.m,this.n),e=0;e<this.m;e++)for(var n=0;n<this.n;n++)a.data[e][n]=this.data[e][n]+t.data[e][n];return a},minus:function(t){if(this.m!=t.m||this.n!=t.n)throw new Error("\u77e9\u9635\u51cf\u6cd5\u6cd5\u884c\u5217\u4e0d\u5339\u914d");for(var a=new r.Matrix([],this.m,this.n),e=0;e<this.m;e++)for(var n=0;n<this.n;n++)a.data[e][n]=this.data[e][n]-t.data[e][n];return a},mutiply:function(t){if(this.n!=t.m)throw new Error("\u77e9\u9635\u4e58\u6cd5\u884c\u5217\u4e0d\u5339\u914d");for(var a=new r.Matrix([],this.m,t.n),e=0;e<this.m;e++)for(var n=0;n<t.n;n++){for(var i=0,o=0;o<this.n;o++)i+=this.data[e][o]*t.data[o][n];a.data[e][n]=i}return a}},r.C.prototype={plus:function(t){var a=new r.C;return a.r=this.r+t.r,a.i=this.i+t.i,a},minus:function(t){var a=new r.C;return a.r=this.r-t.r,a.i=this.i-t.i,a},mutiply:function(t){var a=new r.C;return a.r=this.r*t.r-this.i*t.i,a.i=this.r*t.i+this.i*t.r,a},divide:function(t){var a=new r.C,e=t.mutiply(t.conjugated()),n=this.mutiply(t.conjugated());return a.r=n.r/e.r,a.i=n.i/e.r,a},conjugated:function(){var t=new r.C(this.r,-this.i);return t},distance:function(){return Math.sqrt(this.r*this.r+this.i*this.i)}},r})}("psLib"),function(t){window[t].module("dorsyWorker",function(t){var r=200,a=function(a){var e=new Worker(t.path);if(!e)throw new Error("\u4f7f\u7528worker\u65f6\uff0calloyimage\u6587\u4ef6\u76ee\u5f55\u6307\u5b9a\u51fa\u9519");var n={queue:[],startWorker:function(){this.shiftAction()},shiftAction:function(){function t(){if(n[1].readyState){var i=[a.imgData,n[1].imgData].concat(n.slice(2));e.postMessage(["add",i])}else setTimeout(function(){t()},r)}var n=this.queue.shift(),i=this;if(!n)return void setTimeout(function(){n=i.queue.shift(),n||a.notify("readyStateOK")},r);var o=n[0];"act"==o?e.postMessage(["act",n[1],a.imgData,n[2]]):"add"==o?t():"show"==o?(a.show(n[1],n[2],1),this.shiftAction()):"complete"==o?(n[1]&&n[1](),this.shiftAction()):"clone"==o?(a.clone(1),this.shiftAction()):"save"==o?(a.save(0,1),this.shiftAction()):"replace"==o&&(a.replace(n[1],1),this.shiftAction())},callback:function(t){a.imgData=t,this.shiftAction()}};return e.onmessage=function(t){n.callback(t.data)},n};return a})}("psLib"),function(t){window[t].module("easy",function(r){var a={getFun:function(r){var a={softenFace:function(){var t=this.clone();return t.add(this.act("\u9ad8\u65af\u6a21\u7cca",10),"\u6ee4\u8272").act("\u4eae\u5ea6",-10,5)},sketch:function(){var t=this.clone();return this.add(t.act("\u53cd\u8272").act("\u9ad8\u65af\u6a21\u7cca",8),"\u989c\u8272\u51cf\u6de1").act("toGray").act("\u9510\u5316",1)},softEnhancement:function(){return this.act("\u66f2\u7ebf",[0,190,255],[0,229,255])},purpleStyle:function(){var t=this.clone();return this.add(t.act("\u9ad8\u65af\u6a21\u7cca",3),"\u6b63\u7247\u53e0\u5e95","RG")},soften:function(){var t=this.clone();return this.add(t.act("\u9ad8\u65af\u6a21\u7cca",6),"\u53d8\u6697")},vintage:function(){this.clone();return this.act("\u7070\u5ea6\u5904\u7406").add(window[t](this.canvas.width,this.canvas.height,"#808080").act("\u6dfb\u52a0\u6742\u8272").act("\u9ad8\u65af\u6a21\u7cca",4).act("\u8272\u76f8/\u9971\u548c\u5ea6\u8c03\u8282",32,19,0,!0),"\u53e0\u52a0")},gray:function(){return this.act("\u7070\u5ea6\u5904\u7406")},lomo:function(){var t=this.clone().add(this.clone(),"\u6ee4\u8272").add(this.clone(),"\u67d4\u5149");return t.add(this.clone().act("\u53cd\u8272"),"\u6b63\u5e38","20%","B").act("\u6697\u89d2",6,200)},strongEnhancement:function(){return this.clone().add(this.clone().act("\u66f2\u7ebf",[0,50,255],[0,234,255]),"\u67d4\u5149")},strongGray:function(){return this.act("\u7070\u5ea6\u5904\u7406").act("\u66f2\u7ebf",[0,61,69,212,255],[0,111,176,237,255])},lightGray:function(){return this.act("\u7070\u5ea6\u5904\u7406").act("\u66f2\u7ebf",[0,60,142,194,255],[0,194,240,247,255])},warmAutumn:function(){var t=this.clone().act("\u8272\u76f8/\u9971\u548c\u5ea6\u8c03\u8282",36,47,8,!0).act("\u6697\u89d2",6,150);return this.add(t,"\u53e0\u52a0")},carveStyle:function(){var t=this.clone().act("\u9a6c\u8d5b\u514b").act("\u67e5\u627e\u8fb9\u7f18").act("\u6d6e\u96d5\u6548\u679c");return this.add(t,"\u7ebf\u6027\u5149")},rough:function(){return this.add(window[t](this.canvas.width,this.canvas.height,"#000").act("\u55b7\u70b9").act("\u53cd\u8272").act("\u6d6e\u96d5\u6548\u679c"),"\u53e0\u52a0")}};return a[r]}};return a})}("psLib"),function(t){window[t].module("Tools",function(t){var r={getColor:{process:function(r,a){var e,n,i=t.lib.dorsyMath,o=(i.xyToIFun(r.width),50),s=2*Math.PI/o,h=[];i.applyInHSI(r,function(t){n=parseInt(t.H/s),h[n]||(h[n]=[]),h[n].push([t.S,t.I])});for(var c=0,u=0,e=0;e<o;e++)h[e]&&h[e].length>c&&(c=h[e].length,u=e);for(var f,d,l=0,v=0,e=0;e<h[u].length;e++)l+=h[u][e][0],v+=h[u][e][1];f=l/h[u].length,d=v/h[u].length;var p=u*s,g=i.HSIToRGB(p,f,d),w="rgb("+parseInt(g.R)+","+parseInt(g.G)+","+parseInt(g.B)+")";return w}},toText:{process:function(r,a){var e,n=r.data,i=r.width,o=r.height,s=a[0]||".:;!#@",h="";console.log(s);for(var c,u,f=t.lib.dorsyMath,d=f.xyToIFun(r.width),l=255/s.length,v=0;v<i;v+=1){for(var p=0;p<o;p+=1)c=d(v,p,0),e=(n[c]+n[c+1]+n[c+2])/3,u=parseInt(e/l),h+=s[u];h+="<br />"}return h}}};return r})}("psLib"),function(t){window[t].module("Alteration.brightness",function(t){var r={process:function(t,r){for(var a=t.data,e=r[0]/50,n=r[1]||0,i=n/50,o=Math.tan((45+44*i)*Math.PI/180),s=0,h=a.length;s<h;s+=4)for(var c=0;c<3;c++)a[s+c]=(a[s+c]-127.5*(1-e))*o+127.5*(1+e);return t}};return r})}("psLib"),function(t){window[t].module("Alteration.curve",function(t){var r={process:function(r,a){for(var e=t.lib.dorsyMath.lagrange(a[0],a[1]),n=r.data,i=r.width,o=r.height,s=0;s<i;s++)for(var h=0;h<o;h++)for(var c=h*i+s,u=0;u<3;u++)n[4*c+u]=e(n[4*c+u]);return r}};return r})}("psLib"),function(t){window[t].module("Alteration.gamma",function(t){var r={process:function(r,a){var e,n=t.lib.dorsyMath,i=(r.data,r.width),o=r.height;e=void 0==a[0]?10:a[0];for(var s=(e+100)/200*2,h=0;h<i;h++)for(var c=0;c<o;c++)n.xyCal(r,h,c,function(t,r,a){return[Math.pow(t,s),Math.pow(r,s),Math.pow(a,s)]});return r}};return r})}("psLib"),function(t){window[t].module("Alteration.setHSI",function(t){var r={process:function(r,a){return a[0]=a[0]/180*Math.PI,a[1]=a[1]/100||0,a[2]=a[2]/100*255||0,a[3]=a[3]||!1,t.lib.dorsyMath.applyInHSI(r,function(t){a[3]?(t.H=a[0],t.S=a[1],t.I+=a[2]):(t.H+=a[0],t.S+=a[1],t.I+=a[2])}),r}};return r})}("psLib"),function(t){window[t].module("Filter.corrode",function(t){var r={process:function(t,r){for(var a=parseInt(r[0])||3,e=t.data,n=t.width,i=t.height,o=0;o<n;o++)for(var s=0;s<i;s++)for(var h=parseInt(Math.random()*a*2)-a,c=parseInt(Math.random()*a*2)-a,u=s*n+o,f=(s+h)*n+o+c,d=0;d<3;d++)e[4*u+d]=e[4*f+d];return t}};return r})}("psLib"),function(t){window[t].module("Filter.darkCorner",function(t){var r={process:function(r,a){function e(r,a,e){var n=t.lib.dorsyMath.distance([r,a],[c,u]),o=(n-d)/(f-d);return o<0&&(o=0),l(o,0,.02,.3,1)*e*i/255}for(var n=parseInt(a[0])||3,i=(a[2]||"round",a[1]||30),o=r.data,s=r.width,h=r.height,c=2*s/3,u=1*h/2,f=t.lib.dorsyMath.distance([c,u]),d=f*(1-n/10),l=function(t,r,a,e,n){return r*Math.pow(1-t,3)+3*a*t*Math.pow(1-t,2)+3*e*t*t*(1-t)+n*Math.pow(t,3)},v=0;v<s;v++)for(var p=0;p<h;p++)for(var g=p*s+v,w=0;w<3;w++){var m=e(v,p,o[4*g+w]);o[4*g+w]-=m}return r}};return r})}("psLib"),function(t){window[t].module("Filter.denoise",function(t){var r={process:function(r,a){for(var e=t.lib.dorsyMath,n=(r.data,r.width),i=r.height,o=0;o<n;o++)for(var s=0;s<i;s++)e.xyCal(r,o,s,function(t,r,a){return[.393*t+.769*r+.189*a,.349*t+.686*r+.168*a,.272*t+.534*r+.131*a]});return r}};return r})}("psLib"),function(t){window[t].module("Filter.dotted",function(t){var r={process:function(r,a){for(var e=parseInt(a[0])||1,n=parseInt(a[1])||1,i=r.data,o=r.width,s=r.height,h=2*e+1,c=[],u=n*n,f=-e;f<e;f++)for(var d=-e;d<e;d++)f*f+d*d>u&&c.push([f,d]);for(var l=t.lib.dorsyMath.xyToIFun(o),f=0,v=parseInt(o/h);f<v;f++)for(var d=0,p=parseInt(s/h);d<p;d++)for(var g=parseInt((f+.5)*h),w=parseInt((d+.5)*h),m=0;m<c.length;m++){var y=g+c[m][0],I=w+c[m][1];i[l(y,I,3)]=225,i[l(y,I,2)]=225,i[l(y,I,0)]=225,i[l(y,I,1)]=225}return r}};return r})}("psLib"),function(t){window[t].module("Filter.embossment",function(t){var r={process:function(t,r){for(var a=t.data,e=t.width,n=(t.height,[]),i=0,o=a.length;i<o;i+=4){var s=i/4,h=parseInt(s/e),c=s%e,u=4*((h-1)*e+(c-1)),f=(h+1)*e*4+4*(c+1);if(0!=h&&0!=c){for(var d=0;d<3;d++)n[i+d]=a[u+d]-a[f+d]+127.5;n[i+4]=a[i+4]}}for(var i=0,o=a.length;i<o;i++)a[i]=n[i]||a[i];return t}};return r})}("psLib"),function(t){window[t].module("Filter.gaussBlur",function(t){var r={process:function(t,r,a){var e,n,i,o,s,h,c,u,f,d,l=t.data,v=t.width,p=t.height,g=[],w=0;for(r=Math.floor(r)||3,a=a||r/3,h=1/(Math.sqrt(2*Math.PI)*a),s=-1/(2*a*a),c=0,e=-r;e<=r;e++,c++)o=h*Math.exp(s*e*e),g[c]=o,w+=o;for(c=0,d=g.length;c<d;c++)g[c]/=w;for(n=0;n<p;n++)for(e=0;e<v;e++){for(i=o=s=h=0,w=0,u=-r;u<=r;u++)f=e+u,f>=0&&f<v&&(c=4*(n*v+f),i+=l[c]*g[u+r],o+=l[c+1]*g[u+r],s+=l[c+2]*g[u+r],w+=g[u+r]);c=4*(n*v+e),l[c]=i/w,l[c+1]=o/w,l[c+2]=s/w}for(e=0;e<v;e++)for(n=0;n<p;n++){for(i=o=s=h=0,w=0,u=-r;u<=r;u++)f=n+u,f>=0&&f<p&&(c=4*(f*v+e),i+=l[c]*g[u+r],o+=l[c+1]*g[u+r],s+=l[c+2]*g[u+r],w+=g[u+r]);c=4*(n*v+e),l[c]=i/w,l[c+1]=o/w,l[c+2]=s/w}return t.data=l,t}};return r})}("psLib"),function(t){window[t].module("Filter.ImageEnhance",function(t){var r={process:function(t,r,a){for(var e=(arg||.5,t.data),n=(t.width,t.height,0),i=e.length;n<i;n+=4);return t.data=e,t}};return r})}("psLib"),function(t){window[t].module("Filter.borderline",function(t){var r={process:function(r,a){var e=[0,1,0,1,-4,1,0,1,0];return t.lib.dorsyMath.applyMatrix(r,e,250)}};return r})}("psLib"),function(t){window[t].module("Filter.mosaic",function(t){var r={process:function(t,r){for(var a=parseInt(r[0])||3,e=t.data,n=t.width,i=t.height,o=2*a+1,s=0,h=parseInt(n/o);s<h;s++)for(var c=0,u=parseInt(i/o);c<u;c++){for(var f=[],d=[0,0,0],l=0;l<o;l++)for(var v=0;v<o;v++){var p=(c*o+l)*n+s*o+v;d[0]+=e[4*p],d[1]+=e[4*p+1],d[2]+=e[4*p+2]}f[0]=d[0]/(o*o),f[1]=d[1]/(o*o),f[2]=d[2]/(o*o);for(var l=0;l<o;l++)for(var v=0;v<o;v++){var p=(c*o+l)*n+s*o+v;e[4*p]=f[0],e[4*p+1]=f[1],e[4*p+2]=f[2]}}return t}};return r})}("psLib"),function(t){window[t].module("Filter.noise",function(t){var r={process:function(t,r){for(var a=parseInt(r[0])||100,e=t.data,n=t.width,i=t.height,o=0;o<n;o++)for(var s=0;s<i;s++)for(var h=s*n+o,c=0;c<3;c++){var u=parseInt(Math.random()*a*2)-a;e[4*h+c]+=u}return t}};return r})}("psLib"),function(t){window[t].module("Filter.oilPainting",function(t){var r={process:function(t,r){for(var a=parseInt(r[0])||16,e=t.data,n=t.width,i=t.height,o=0;o<n;o++)for(var s=0;s<i;s++){for(var h=s*n+o,c=0,u=0;u<3;u++)c+=e[4*h+u];c/=3;for(var f=parseInt(c/a)*a,d=0;d<3;d++)e[4*h+d]=f}return t}};return r})}("psLib"),function(t){window[t].module("Filter.posterize",function(t){var r={process:function(r,a){var e=t.lib.dorsyMath,n=(r.data,r.width),i=r.height,o=a[0]||20;o=o<1?1:o>255?255:o;for(var s=Math.floor(255/o),h=0;h<n;h++)for(var c=0;c<i;c++)e.xyCal(r,h,c,function(t,r,a){return[Math.floor(t/s)*s,Math.floor(r/s)*s,Math.floor(a/s)*s]});return r}};return r})}("psLib"),function(t){window[t].module("Filter.sepia",function(t){var r={process:function(r){for(var a=t.lib.dorsyMath,e=(r.data,r.width),n=r.height,i=0;i<e;i++)for(var o=0;o<n;o++)a.xyCal(r,i,o,function(t,r,a){return[.393*t+.769*r+.189*a,.349*t+.686*r+.168*a,.272*t+.534*r+.131*a]});return r}};return r})}("psLib"),function(t){window[t].module("Filter.sharp",function(t){var r={process:function(t,r){for(var a=r[0]||.6,e=t.data,n=t.width,i=(t.height,0),o=e.length;i<o;i+=4){var s=i/4,h=parseInt(s/n),c=s%n;if(0!=h&&0!=c)for(var u=4*((h-1)*n+(c-1)),f=4*((h-1)*n+c),d=4*(s-1),l=0;l<3;l++){var v=e[i+l]-(e[f+l]+e[d+l]+e[u+l])/3;e[i+l]+=v*a}}return t}};return r})}("psLib"),function(t){window[t].module("Filter.toGray",function(t){var r={process:function(t){for(var r=t.data,a=0,e=r.length;a<e;a+=4){var n=parseInt(.299*r[a]+.578*r[a+1]+.114*r[a+2]);r[a+2]=r[a+1]=r[a]=n}return t.data=r,t}};return r})}("psLib"),function(t){window[t].module("Filter.toReverse",function(t){var r={process:function(t){for(var r=t.data,a=0,e=r.length;a<e;a+=4)r[a]=255-r[a],r[a+1]=255-r[a+1],r[a+2]=255-r[a+2];return t.data=r,t}};return r})}("psLib"),function(t){window[t].module("Filter.toThresh",function(t){var r={process:function(r,a){r=t.reflect("toGray",r);var e=r.data;a=a[0]||128;for(var n=0,i=e.length;n<i;n++)(n+1)%4&&(e[n]=e[n]>a?255:0);return r.data=e,r}};return r})}("psLib");